import{_ as s,o as a,c as n,a as l}from"./app.9b639de6.js";const p=JSON.parse('{"title":"","description":"","frontmatter":{"footer":false,"outline":"deep"},"headers":[{"level":2,"title":"目标","slug":"目标","link":"#目标","children":[]},{"level":2,"title":"工具及其关系概览","slug":"工具及其关系概览","link":"#工具及其关系概览","children":[]},{"level":2,"title":"准备","slug":"准备","link":"#准备","children":[]},{"level":2,"title":"实施步骤","slug":"实施步骤","link":"#实施步骤","children":[{"level":3,"title":"维护密钥","slug":"维护密钥","link":"#维护密钥","children":[]},{"level":3,"title":"安装argoCD","slug":"安装argocd","link":"#安装argocd","children":[]},{"level":3,"title":"安装argoCD app","slug":"安装argocd-app","link":"#安装argocd-app","children":[]},{"level":3,"title":"向vault同步宿主集群/运行时集群的认证信息【补充】","slug":"向vault同步宿主集群-运行时集群的认证信息【补充】","link":"#向vault同步宿主集群-运行时集群的认证信息【补充】","children":[]},{"level":3,"title":"执行流水线","slug":"执行流水线","link":"#执行流水线","children":[]}]},{"level":2,"title":"附件","slug":"附件","link":"#附件","children":[{"level":3,"title":"预置的证书和私钥","slug":"预置的证书和私钥","link":"#预置的证书和私钥","children":[]},{"level":3,"title":"参考链接","slug":"参考链接","link":"#参考链接","children":[]},{"level":3,"title":"替换服务地址配置","slug":"替换服务地址配置","link":"#替换服务地址配置","children":[]}]},{"level":2,"title":"未完成（2022.11.12，正式提交后删除该章节）","slug":"未完成（2022-11-12，正式提交后删除该章节）","link":"#未完成（2022-11-12，正式提交后删除该章节）","children":[]}],"relativePath":"guide/CICD-quickStart.md"}'),e={name:"guide/CICD-quickStart.md"},o=[l('<h2 id="目标" tabindex="-1">目标 <a class="header-anchor" href="#目标" aria-hidden="true">#</a></h2><p>基于开源工具搭建CI环境，并实现一个代码提交即构建的流水线。</p><h2 id="工具及其关系概览" tabindex="-1">工具及其关系概览 <a class="header-anchor" href="#工具及其关系概览" aria-hidden="true">#</a></h2><p><img src="/docs/assets/CI-1.01e692c2.jpg" alt="directive syntax graph"></p><ul><li>metallb: k8s的lb工具。</li><li>traefik: 反向代理工具，用于ingress的实现。</li><li>cert-manager: 证书签发工具。</li><li>vault: 密钥管理工具。</li><li>external-secrets: 可以将外部的密钥同步为k8s的secret。</li><li>vcluster: 可以在物理k8s集群中创建虚拟集群的工具。</li><li>argo-events: 提供事件监听、转换和触发的工具。</li><li>tekton: k8s原生的流水线工具。</li></ul><p>【补充工具间关系、说明整体实施结构和协同关系】</p><h2 id="准备" tabindex="-1">准备 <a class="header-anchor" href="#准备" aria-hidden="true">#</a></h2><p>以下服务有多种安装方式，下文只是其中一种方式。【说明的适用范围】</p><p><strong>安装一个kubernetes集群</strong><br> 通过命令安装K3s。</p><div class="language-Shell"><button class="copy"></button><span class="lang">Shell</span><pre><code><span class="line"><span style="color:#676E95;"># 替换tls-san IP为宿主机IP</span></span>\n<span class="line"><span style="color:#A6ACCD;">curl -sfL https://get.k3s.io </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> INSTALL_K3S_VERSION=v1.21.14+k3s1 sh -s - server --disable servicelb --disable traefik --disable metrics-server --tls-san 119.8.99.179</span></span>\n<span class="line"><span style="color:#A6ACCD;">cp /etc/rancher/k3s/k3s.yaml </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">/.kube/k3s-config</span></span>\n<span class="line"><span style="color:#A6ACCD;">cp /etc/rancher/k3s/k3s.yaml </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">/.kube/config</span></span>\n<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> KUBECONFIG=</span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">/.kube/config</span></span>\n<span class="line"></span></code></pre></div><p><strong>安装一个vault实例</strong><br> vault有多种安装方式，包括安装包、helm、源码和docker安装。下文使用安装包安装。</p><ul><li><p>下载并配置vault，参见<a href="https://developer.hashicorp.com/vault/docs/install#precompiled-binaries" target="_blank" rel="noreferrer">官网链接</a>。</p></li><li><p>更新默认配置文件，启动vault服务。</p><div class="language-Shell"><button class="copy"></button><span class="lang">Shell</span><pre><code><span class="line"><span style="color:#676E95;"># config.hcl的默认路径：/opt/vault/config</span></span>\n<span class="line"><span style="color:#A6ACCD;">cat config.hcl</span></span>\n<span class="line"><span style="color:#A6ACCD;">storage </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">raft</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">     </span></span>\n<span class="line"><span style="color:#A6ACCD;">   path    = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/opt/vault/data</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   node_id = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">node1</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#89DDFF;">}</span></span>\n<span class="line"><span style="color:#676E95;">#  更新address端为预置端口</span></span>\n<span class="line"><span style="color:#A6ACCD;">listener </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tcp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">     </span></span>\n<span class="line"><span style="color:#A6ACCD;">   address     = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0.0.0.0:31820</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">   tls_disable = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#89DDFF;">}</span></span>\n<span class="line"><span style="color:#A6ACCD;">disable_mlock = </span><span style="color:#82AAFF;">true</span></span>\n<span class="line"><span style="color:#676E95;">#  更新api_addr和cluster_addr的端口为预置端口</span></span>\n<span class="line"><span style="color:#A6ACCD;">api_addr = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://0.0.0.0:31820</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">   </span></span>\n<span class="line"><span style="color:#A6ACCD;">cluster_addr = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://192.168.0.243:31821</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">ui = </span><span style="color:#82AAFF;">true</span></span>\n<span class="line"></span></code></pre></div></li></ul><p><strong>在宿主机安装argocd命令行</strong><br> 下载并配置argoCD命令行，参见<a href="https://argo-cd.readthedocs.io/en/stable/cli_installation/#download-with-curl" target="_blank" rel="noreferrer">官网链接</a>。</p><p><strong>了解Github DEMO代码库的作用</strong> 【修改措辞】</p><ul><li>配置CI基础环境和代码提交即触发流水线：<a href="https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton" target="_blank" rel="noreferrer">demo-pipeline-argoevents-tekton</a></li><li>存储应用源码和流水线：<a href="https://github.com/lanbingcloud/demo-user-project" target="_blank" rel="noreferrer">demo-user-project</a></li><li>存储应用部署的资源文件：<a href="https://github.com/lanbingcloud/demo-user-deployments" target="_blank" rel="noreferrer">demo-user-deployments</a></li></ul><h2 id="实施步骤" tabindex="-1">实施步骤 <a class="header-anchor" href="#实施步骤" aria-hidden="true">#</a></h2><ul><li><strong>维护密钥</strong>：在vault服务端维护本次DEMO需要的所有密钥，以及密钥的访问策略。</li><li><strong>安装argoCD</strong>：在宿主集群安装argoCD。</li><li><strong>安装argoCD app</strong>： 在宿主集群上的argoCD，创建根project和根app，使得argoCD通过<a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/cluster-bootstrapping/#app-of-apps-pattern" target="_blank" rel="noreferrer">app of apps</a>的方式自动安装宿主集群的资源、运行时集群以及运行时集群的资源。</li><li><strong>向vault同步宿主/运行时集群的认证信息</strong>: 同步集群的认证信息，帮助kubernetes资源使用存储在vault的密钥。</li><li><strong>执行流水线</strong>：向fork <a href="https://github.com/lanbingcloud/demo-user-project" target="_blank" rel="noreferrer">demo-user-project</a>的目标代码库推送代码，触发流水线自动执行。</li></ul><h3 id="维护密钥" tabindex="-1">维护密钥 <a class="header-anchor" href="#维护密钥" aria-hidden="true">#</a></h3><h4 id="cert-manager" tabindex="-1">cert-manager <a class="header-anchor" href="#cert-manager" aria-hidden="true">#</a></h4><p>存储cert-manager的证书和私钥。</p><ul><li><p>这里使用<a href="#%E9%A2%84%E7%BD%AE%E7%9A%84%E8%AF%81%E4%B9%A6%E5%92%8C%E7%A7%81%E9%92%A5">预置的证书和私钥</a>。</p></li><li><p>访问vault界面，创建secret和policy：</p><ul><li>创建secret：启用Secrets Engine、并创建secret，详情参见下表：</li></ul><table><thead><tr><th style="text-align:left;"></th><th style="text-align:left;"></th><th style="text-align:left;">属性（或者key）</th><th style="text-align:left;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Secrets Engine</td><td style="text-align:left;"></td><td style="text-align:left;">type</td><td style="text-align:left;">KV</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"></td><td style="text-align:left;">path</td><td style="text-align:left;">pki</td></tr><tr><td style="text-align:left;">secret</td><td style="text-align:left;"></td><td style="text-align:left;">secret path</td><td style="text-align:left;">root</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">secret data</td><td style="text-align:left;">tls.crt</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">secret data</td><td style="text-align:left;">tls.key</td><td style="text-align:left;"></td></tr></tbody></table><ul><li>创建policy：设置policy名称为pki-root，参见下文代码块。</li></ul><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">path &quot;pki/data/root&quot; {</span></span>\n<span class="line"><span style="color:#A6ACCD;">  capabilities = [&quot;read&quot;]</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></li></ul><h4 id="argo-events" tabindex="-1">argo-events <a class="header-anchor" href="#argo-events" aria-hidden="true">#</a></h4><p>存储argoevents需要的密钥，包括：创建github webhook的accesstoken、防止webhook被非法调用的github secret。</p><ul><li><p>新增github accesstoken：访问目标代码库（fork <a href="https://github.com/lanbingcloud/demo-user-project" target="_blank" rel="noreferrer">demo-user-project</a>）的github界面，在“账号Settings - Developer settings - Personal access token - Token(classic)”操作路径下，新增classic类型的token，填写描述、选择授权范围（授予repo和project的权限）后保存。保存生成的token，关闭界面之后将不再显示。</p></li><li><p>新增github secret：访问目标代码库（fork <a href="https://github.com/lanbingcloud/demo-user-project" target="_blank" rel="noreferrer">demo-user-project</a>）的github界面，在“Settings-Security-Secrets-Actions”操作路径下，新增repository secrets，填写secrets后保存，secrets可以是随机字符串（例如uuid）。保存明文的secrets，关闭界面之后将不再显示明文。</p></li><li><p>访问vault界面，配置secrets和policy：</p><ul><li>创建secret：启用Secrets Engine、并创建secret，详情参见下表：</li></ul><table><thead><tr><th style="text-align:left;"></th><th style="text-align:left;"></th><th style="text-align:left;">属性（或者key）</th><th style="text-align:left;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Secrets Engine</td><td style="text-align:left;"></td><td style="text-align:left;">type</td><td style="text-align:left;">KV</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"></td><td style="text-align:left;">path</td><td style="text-align:left;">git</td></tr><tr><td style="text-align:left;">secret</td><td style="text-align:left;"></td><td style="text-align:left;">secret path</td><td style="text-align:left;">github/user-project/argoevents/webhook-access</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">secret data</td><td style="text-align:left;">token</td><td style="text-align:left;">github accesstoken</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">secret data</td><td style="text-align:left;">secret</td><td style="text-align:left;">github secret（明文）</td></tr></tbody></table><ul><li>创建policy：设置policy名称为git-github-user-project-argoevents-webhook-access，参见下文代码块。</li></ul><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">path &quot;git/data/github/user-project/argoevents/webhook-access&quot; {</span></span>\n<span class="line"><span style="color:#A6ACCD;">  capabilities = [&quot;read&quot;]</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></li></ul><h4 id="pipeline" tabindex="-1">pipeline <a class="header-anchor" href="#pipeline" aria-hidden="true">#</a></h4><ol><li>存储向github packager推送镜像的密钥。</li></ol><ul><li><p>新增推送镜像的github账号密码。组成格式为：&lt;account_name&gt;:&lt;personal_access_tokens&gt;，例如：zhangsan:ghp_xxxx。这里使用了和argo-events相同的accesstoken，具备repo的写入权限。再使用base64加密，保存备用。</p></li><li><p>访问vault界面，配置secrets和policy：</p><ul><li>创建secrets：启用Secrets Engine、并创建secret，详情参见下表：</li></ul><table><thead><tr><th style="text-align:left;"></th><th style="text-align:left;"></th><th style="text-align:left;">属性（或者key）</th><th style="text-align:left;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Secrets Engine</td><td style="text-align:left;"></td><td style="text-align:left;">type</td><td style="text-align:left;">KV</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"></td><td style="text-align:left;">path</td><td style="text-align:left;">repo</td></tr><tr><td style="text-align:left;">secret</td><td style="text-align:left;"></td><td style="text-align:left;">secret path</td><td style="text-align:left;">github/container/lanbing/default/readwrite</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">secret data</td><td style="text-align:left;">auth</td><td style="text-align:left;">github账号密码（密文）</td></tr></tbody></table><ul><li>创建policy：设置policy名称为repo-github-container-lanbing-default-readwrite，参见下文代码块。</li></ul><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">path &quot;repo/data/github/container/lanbing/default/readwrite&quot; {</span></span>\n<span class="line"><span style="color:#A6ACCD;">    capabilities = [&quot;read&quot;]</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></li></ul><ol start="2"><li>存储向目标代码库推送代码的密钥。</li></ol><ul><li><p>新增ssh密钥。</p><div class="language-Shell"><button class="copy"></button><span class="lang">Shell</span><pre><code><span class="line"><span style="color:#676E95;"># 使用git客户端生成密钥，其中邮箱替换为github账号的邮箱 </span></span>\n<span class="line"><span style="color:#A6ACCD;">ssh-keygen -t ed25519 -C </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">your_email@example.com</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#676E95;"># ssh密钥的默认名称为：id_ed25519、id_ed25519.pub</span></span>\n<span class="line"><span style="color:#A6ACCD;">ls -al </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">/.ssh</span></span>\n<span class="line"><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;$(</span><span style="color:#C3E88D;">ssh-agent -s</span><span style="color:#89DDFF;">)&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">ssh-add </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">/.ssh/id_ed25519</span></span>\n<span class="line"><span style="color:#A6ACCD;">cat </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">/.ssh/id_ed25519</span></span>\n<span class="line"><span style="color:#A6ACCD;">cat </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">/.ssh/id_ed25519.pub</span></span>\n<span class="line"></span></code></pre></div></li><li><p>访问目标代码库(fork <a href="https://github.com/lanbingcloud/demo-user-deployments" target="_blank" rel="noreferrer">demo-user-deployments</a>)的github界面，新增deploy key，设置值为ssh公钥，并授权代码库的写入权限。</p></li><li><p>访问vault界面，配置secrets和policy：</p><ul><li>创建secrets：启用Secrets Engine、并创建secret，详情参见下表：</li></ul><table><thead><tr><th style="text-align:left;"></th><th style="text-align:left;"></th><th style="text-align:left;">属性（或者key）</th><th style="text-align:left;">值</th></tr></thead><tbody><tr><td style="text-align:left;">Secrets Engine</td><td style="text-align:left;"></td><td style="text-align:left;">type</td><td style="text-align:left;">KV</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"></td><td style="text-align:left;">path</td><td style="text-align:left;">git</td></tr><tr><td style="text-align:left;">secret</td><td style="text-align:left;"></td><td style="text-align:left;">secret path</td><td style="text-align:left;">github/user-deployments/default/readwrite</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;">secret data</td><td style="text-align:left;">deploykey</td><td style="text-align:left;">ssh私钥(末尾预留一行空行)</td></tr></tbody></table><ul><li>创建policy：设置policy名称为git-github-user-deployments-default-readwrite，参见下文代码块。</li></ul><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">path &quot;git/data/github/user-deployments/default/readwrite&quot; {</span></span>\n<span class="line"><span style="color:#A6ACCD;">    capabilities = [&quot;read&quot;]</span></span>\n<span class="line"><span style="color:#A6ACCD;">}</span></span>\n<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></li></ul><h3 id="安装argocd" tabindex="-1">安装argoCD <a class="header-anchor" href="#安装argocd" aria-hidden="true">#</a></h3><p>在宿主集群安装argoCD。</p><div class="language-Shell"><button class="copy"></button><span class="lang">Shell</span><pre><code><span class="line"><span style="color:#676E95;"># 切换到宿主集群 </span></span>\n<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> KUBECONFIG=</span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;">/.kube/config</span></span>\n<span class="line"><span style="color:#676E95;"># clone目标代码库(fork demo-pipeline-argoevents-tekton)，cd到相对路径cmds，执行安装脚本</span></span>\n<span class="line"><span style="color:#A6ACCD;">sh install-argocd.sh</span></span>\n<span class="line"><span style="color:#676E95;"># 执行argocd的补丁脚本 </span></span>\n<span class="line"><span style="color:#A6ACCD;">sh patch-argocd-server.sh</span></span>\n<span class="line"></span></code></pre></div><h3 id="安装argocd-app" tabindex="-1">安装argoCD app <a class="header-anchor" href="#安装argocd-app" aria-hidden="true">#</a></h3><p>在宿主集群上的argoCD，安装根project和根app，使得argoCD通过<a href="https://argo-cd.readthedocs.io/en/stable/operator-manual/cluster-bootstrapping/#app-of-apps-pattern" target="_blank" rel="noreferrer">app of apps</a>的方式自动安装宿主集群的资源、运行时集群以及运行时集群的资源。</p><h4 id="替换服务地址" tabindex="-1">替换服务地址 <a class="header-anchor" href="#替换服务地址" aria-hidden="true">#</a></h4><p>变更范围包括：argoCD app监听的源代码库地址、宿主集群的地址、运行时集群的地址，以及变更地址的关联资源，详情参见“附件-替换服务地址配置”。</p><ul><li><a href="http://xn--sed-demo-oc0qm31ad0ay7dl2jm17g.sh" target="_blank" rel="noreferrer">根据脚本模板sed-demo.sh</a>，替换代码库地址、集群地址等，详见下文代码注释。</li></ul><div class="language-shell"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#A6ACCD;">cat sed-demo.sh</span></span>\n<span class="line"><span style="color:#676E95;"># 目标代码库(fork demo-pipeline-argoevents-tekton)</span></span>\n<span class="line"><span style="color:#676E95;"># 批量替换argocd监听代码库地址为目标代码库</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton.git#https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">grep https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton.git -rl demo-pipeline-argoevents-tekton-1</span><span style="color:#89DDFF;">`</span></span>\n<span class="line"><span style="color:#676E95;"># 批量替换宿主集群IP地址、宿主机IP地址、vault服务端IP地址(这里vault也安装在同一台宿主机)</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#192.168.0.184#192.168.0.243#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">grep 192.168.0.184 -rl demo-pipeline-argoevents-tekton-1</span><span style="color:#89DDFF;">`</span></span>\n<span class="line"><span style="color:#676E95;"># 批量替换ingress的地址</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#119-8-58-20#119-8-99-179#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">grep 119-8-58-20 -rl demo-pipeline-argoevents-tekton-1</span><span style="color:#89DDFF;">`</span></span>\n<span class="line"><span style="color:#676E95;"># 替换argo-events中eventsource的repo信息，包括owner和names</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#lanbingcloud#zhangsan#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  demo-pipeline-argoevents-tekton-1/argo-events/overlays/production/eventsource.yaml</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#demo-user-project#demo-user-project-1#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  demo-pipeline-argoevents-tekton-1/argo-events/overlays/production/eventsource.yaml</span></span>\n<span class="line"><span style="color:#676E95;">#  替换argo-events中init-pipeline.yaml git-clone的代码库地址</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#https://github.com/lanbingcloud/demo-user-project.git#https://github.com/lanbingcloud/demo-user-project-1.git#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> demo-pipeline-argoevents-tekton-1/argo-events/overlays/production/init-pipeline.yaml</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;"># 目标代码库(fork demo-user-project)</span></span>\n<span class="line"><span style="color:#676E95;"># 替换流水线task拉取代码、推送代码、推送镜像的地址</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#https://github.com/lanbingcloud/demo-user-project.git#https://github.com/lanbingcloud/demo-user-project-1.git#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> demo-user-project-1/pipelines/test-pipeline.yaml</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#git@github.com:lanbingcloud/demo-user-deployments.git#git@github.com:lanbingcloud/demo-user-deployments-1.git#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> demo-user-project-1/pipelines/test-pipeline.yaml</span></span>\n<span class="line"><span style="color:#676E95;"># 替换推送镜像的github package</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#ghcr.io/lanbingcloud#ghcr.io/zhangsan#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> demo-user-project-1/pipelines/test-pipeline.yaml</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;"># 目标代码库(fork demo-user-deployments)</span></span>\n<span class="line"><span style="color:#676E95;"># 替换应用svc的外部访问地址</span></span>\n<span class="line"><span style="color:#A6ACCD;">sed -i -e </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">s#119-8-58-20#119-8-99-179#g</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  demo-user-deployments-1/deployments/test/devops-sample-svc.yamlroot@ecs-bd3f:/opt/git/lanbingcloud# </span></span>\n<span class="line"></span></code></pre></div><blockquote><p>[Tips] 上文模板示例的宿主机内网IP：192.168.0.184，外网IP：119.8.99.179</p></blockquote><ul><li>执行sed-demo.sh脚本，批量替换目标代码库的相关配置</li></ul><div class="language-shell"><button class="copy"></button><span class="lang">shell</span><pre><code><span class="line"><span style="color:#A6ACCD;">sh sed-demo.sh</span></span>\n<span class="line"></span></code></pre></div><h4 id="安装根project和根app" tabindex="-1">安装根project和根app <a class="header-anchor" href="#安装根project和根app" aria-hidden="true">#</a></h4><p>通过命令安装根project和根app。</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># cd到demo代码库根目录，安装根project</span></span>\n<span class="line"><span style="color:#A6ACCD;">kubectl -nargocd apply -f project.yaml</span></span>\n<span class="line"><span style="color:#A6ACCD;"># 安装根app，等待初始化结束；</span></span>\n<span class="line"><span style="color:#A6ACCD;">kubectl -nargocd apply -f app.yaml</span></span>\n<span class="line"><span style="color:#A6ACCD;"># 查看argocd app的安装进度和状态，安装过程需要等待一段时间</span></span>\n<span class="line"><span style="color:#A6ACCD;">kubectl -nargocd get apps --watch</span></span>\n<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>通过界面访问安装在k8s空集群上的argoCD（此处示例的argoCD访问地址为<a href="https://argocd.119-8-99-179.nip.io:30443" target="_blank" rel="noreferrer">https://argocd.119-8-99-179.nip.io:30443</a>），并执行脚本cmds/get-argocd-admin-pwd.sh，可获取argoCD的初始密码；初始化结束后观察app状态，两个app未完成同步，其他app处于已同步状态。</p><ul><li>cert-manager：vault服务端未设置了宿主集群（原k8s空集群）的auth授权，导致cert-manager app同步异常；</li><li>root：新生成的vcluster集群没有注册到宿主集群的argoCD，导致runtime-appset、runtime-argocd-appset同步异常。</li></ul><h4 id="修复root-app-注册集群" tabindex="-1">修复root app - 注册集群 <a class="header-anchor" href="#修复root-app-注册集群" aria-hidden="true">#</a></h4><p>对于root app，注册vcluster，使得root app的两个appset可以找到目标部署集群完成部署。</p><ul><li>执行脚本cmds目录下的脚本get-vcluster-kubeconfig.sh获取vcluster的config文件，并保存到宿主机指定目录；并修改config文件的clusters[0].server=https:&lt;内网IP&gt;:&lt;vcluster1-svc的nodeport&gt;、contexts[0].name=&lt;自定义名称&gt;、 current-context=&lt;自定义名称&gt;;</li><li>通过argocd命令添加vcluster；<div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># 切换到宿主集群（原k8s空集群）的上下文，临时修改argocd server的svc类型为NodePort（过程略）; </span></span>\n<span class="line"><span style="color:#A6ACCD;"># 使用命令行登录argocd，规则：argocd login &lt;内网IP&gt;:&lt;argocd server svc的nodeport&gt;； </span></span>\n<span class="line"><span style="color:#A6ACCD;"># 执行cmds目录下的get-argocd-admin-pwd.sh脚本可以获取初始密码； </span></span>\n<span class="line"><span style="color:#A6ACCD;">argocd login 192.168.0.243:30070</span></span>\n<span class="line"><span style="color:#A6ACCD;"># 切换到vcluster的上下文</span></span>\n<span class="line"><span style="color:#A6ACCD;">export KUBECONFIG=/opt/vcluster/kubeconfig-31543.yaml</span></span>\n<span class="line"><span style="color:#A6ACCD;"># 规则：argocd cluster add &lt;cluster-name&gt; --kubeconfig=&lt;kubeconfig.yaml&gt;</span></span>\n<span class="line"><span style="color:#A6ACCD;">argocd cluster add Default31543 --kubeconfig=/opt/vcluster/kubeconfig-31543.yaml</span></span>\n<span class="line"><span style="color:#A6ACCD;"># 查看argocd的集群信息，检查集群是否注册成功</span></span>\n<span class="line"><span style="color:#A6ACCD;">argocd cluster list</span></span>\n<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></li><li>回到argoCD访问界面，进入root app，删除runtime-appset和runtime-argocd-appset，强制其重新生成，观察root app的同步状态更新为已同步。</li></ul><h3 id="向vault同步宿主集群-运行时集群的认证信息【补充】" tabindex="-1">向vault同步宿主集群/运行时集群的认证信息【补充】 <a class="header-anchor" href="#向vault同步宿主集群-运行时集群的认证信息【补充】" aria-hidden="true">#</a></h3><h4 id="修复cert-manager-app-配置vault授权" tabindex="-1">修复cert-manager app - 配置vault授权 <a class="header-anchor" href="#修复cert-manager-app-配置vault授权" aria-hidden="true">#</a></h4><p>对于cert-manager app，通过vault界面配置宿主集群（原k8s空集群）与vault服务端的auth授权。</p><ul><li>准备auth方法需要的信息，包括：kubernetes集群的CA证书、授权sa的token、集群host地址；切换到原k8s空集群的上下文，执行cmds目录下的脚本get-cluster-ca.sh获取CA证书内容、执行get-vault-auth-token.sh获取token、查看~/.kube/config文件明确host地址；</li><li>启用auth方法，类型为kubernetes，path为host-cluster，并且需要将CA证书、token和host等上述信息上传或填写到vault的auth方法；</li><li>对于当前的auth方法，创建配套role，确保cert-manager app可以获取vault中相应的secrets。其中role名称为cert-manager，授权sa为default，授权ns为cert-manager, 授权policy为pki-root，将以上信息保存为auth方法的role;</li><li>回到argoCD访问界面，进入cert-manager app，删除名称为cert-manager-secretstore（类型=SecretStore）、root-issuer（类型=ExternalSecret）、org-issuer（类型=ClusterIssuer）的资源，强制其重新生成；再次观察cert-manager app状态为已同步。</li></ul><h4 id="修复pipeline1-app-配置vault授权" tabindex="-1">修复pipeline1 app - 配置vault授权 <a class="header-anchor" href="#修复pipeline1-app-配置vault授权" aria-hidden="true">#</a></h4><p>当root app状态显示为已同步，通过安装在vcluster上的argoCD访问界面，观察pipeline1 app的相关资源是否安装就绪。</p><ul><li>查看argoCD的界面访问地址（此处示例为<a href="https://argocd.pipeline1.119-8-99-179.nip.io:30443" target="_blank" rel="noreferrer">https://argocd.pipeline1.119-8-99-179.nip.io:30443</a>），切换到vcluster集群的上下文，使用cmds目录下的get-argocd-admin-pwd.sh脚本可获取初始密码；</li><li>观察安装在vcluster上的app状态，此时发现有user-namespaces、argo-events两个app并未处于同步状态。user-namespaces app的pvc一直是pending状态，由于pvc暂未被pods使用，这是正常现像；argo-events app的secretStore资源异常，vault服务端需要给vcluster集群授权；</li><li>通过vault界面配置vcluster集群的auth授权 <ul><li>启用auth方法，类型为kubernetes，path为pipeline1-cluster; 并且需要将vcluster集群的CA证书、token和host等信息上传或填写到vault的auth方法。获取相关信息参见cert-manager app，不再赘述；</li><li>对于当前auth-kubernetes的方法，创建配套role，确保argo-events app可以获取vault中相应的secrets。 其中role=argo-events-sa，授权sa=argo-events-sa，授权ns=argo-events, 授权policy=git-github-user-project-argoevents-webhook-access; 将以上信息提交为上述auth方法的role;</li></ul></li><li>通过argoCD界面删除argo-events app的资源，包括名称为webhook-secretstore（类型=SecretStore）、github-access（类型=ExternalSecret）、webhook（类型=EventSource）的资源，强制其重新生成；观察argoevents app状态为已同步。</li></ul><h3 id="执行流水线" tabindex="-1">执行流水线 <a class="header-anchor" href="#执行流水线" aria-hidden="true">#</a></h3><p>用户侧代码库（此处指demo-user-project）提交代码之后，使用tekton dashboard观察流水线是否自动执行。 本次示例的tekton dashboard地址为：<a href="http://tekton.pipeline1.119-8-99-179.nip.io:30080" target="_blank" rel="noreferrer">http://tekton.pipeline1.119-8-99-179.nip.io:30080</a>。 <img src="/docs/assets/CI-10.7811ea19.jpg" alt="directive syntax graph"></p><ul><li>提交用户侧代码，观察流水线已经触发自动执行；</li><li>发现流水线执行时卡顿在git-clone-deployment task，检查vault服务端未配置授权。确认auth方法的path为pipeline1-cluster（前置步骤已配置），role为user-pipelines，sa为default，ns为user-pipelines，授权policy为git-github-user-deployments-default-readwrite，完整检查流水线的secrets涉及的policy还包括repo-github-container-lanbing-default-readwrite;</li><li>通过vault界面给path为pipeline1-cluster的auth方法配置role，使用上述信息配置；</li><li>再次提交用户侧代码，观察流水线执行成功。</li></ul><h2 id="附件" tabindex="-1">附件 <a class="header-anchor" href="#附件" aria-hidden="true">#</a></h2><h3 id="预置的证书和私钥" tabindex="-1">预置的证书和私钥 <a class="header-anchor" href="#预置的证书和私钥" aria-hidden="true">#</a></h3><p><strong>tls.crt</strong><br> ----BEGIN CERTIFICATE----- MIIC+zCCAeOgAwIBAgIJAMv/rvOaPioGMA0GCSqGSIb3DQEBCwUAMBQxEjAQBgNV BAMMCWJsdXppbi1jYTAeFw0yMjA2MjEwMjEzNTBaFw00OTExMDYwMjEzNTBaMBQx EjAQBgNVBAMMCWJsdXppbi1jYTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC ggEBAKYqCk8qyWNUsvLt/61ie2CGFvdwFLdWCwfk+be0U9wp7Lq6+RR+KERQF3/E G15uRpZPreVO/YJpTetod5RWkJeIMho1eutyhJFdaWWxA1G7oyxL/duWJWGCCd2v VleQD7JjueDC5AXKFQMXBbFcMUB9dv/mPfI/1puMHQbyfvdIsdaTH9gpJGPCl2a+ csDuI/fZJH0yJbWpDbCOhm1JmJ35GweNFIWfkluNU2K4QyH5JMk5dDcLyE4pDkdc MZbyhsadR4ndNbsvj8xhWv4yMXuVcSbkGekhCuzxkUv3RXGLCPgETIbf+8daX3NW o5T69alrFqRzB0NFZgbTHN60vrcCAwEAAaNQME4wHQYDVR0OBBYEFKw6dUhhxRxr DVt3qrZ5l2cWYykmMB8GA1UdIwQYMBaAFKw6dUhhxRxrDVt3qrZ5l2cWYykmMAwG A1UdEwQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBAB2Z94Jbvq9pT4UfjFcV22Bf zF0+jPifVBe3btJdplc0ItvaQZqVWQ8CC5/lz8Xe0bK3rc95hKqxaZERsvjSqmU/ LhlOlhHrE1Zm4fNuh+svEMFnUnk98wnUMeBed897hDRKhpaP6sX88rRdhanvBoja rKLTdjUcbrAT9XeTkVwBSSBG5itGUaEeUmbITZlu9juI031W8Wl28i3dRaWvTDGY /e+FEqu7bz9Pkfu0DKEGpINdFfpl6WV3IbMheORPZM5QNVFkybqgp/ryrRFuVM/U nT4uAguLdb0yB/NhUh+9iwpxkSv5/o547/nQ8JLJHotJkJ7HaXdMKliL3xvr4Qw= -----END CERTIFICATE-----</p><p><strong>tls.key</strong><br> -----BEGIN RSA PRIVATE KEY----- MIIEpAIBAAKCAQEApioKTyrJY1Sy8u3/rWJ7YIYW93AUt1YLB+T5t7RT3Cnsurr5 FH4oRFAXf8QbXm5Glk+t5U79gmlN62h3lFaQl4gyGjV663KEkV1pZbEDUbujLEv9 25YlYYIJ3a9WV5APsmO54MLkBcoVAxcFsVwxQH12/+Y98j/Wm4wdBvJ+90ix1pMf 2CkkY8KXZr5ywO4j99kkfTIltakNsI6GbUmYnfkbB40UhZ+SW41TYrhDIfkkyTl0 NwvITikOR1wxlvKGxp1Hid01uy+PzGFa/jIxe5VxJuQZ6SEK7PGRS/dFcYsI+ARM ht/7x1pfc1ajlPr1qWsWpHMHQ0VmBtMc3rS+twIDAQABAoIBAHV4qykk2pM6wfg0 gdkWEps+sOXlev/R+KJwIorZFaBEk3O/02/FcLo61SIihibQV17Und/LZDXaNJgE luVr/XTjeGhG/suNfmM2Ytjdt7cErGsYnjOrhmnVARyUZLoqwq4fCr33ijT9lLVG hWPKBZfOG172azzkHNiCydKrhU9UFVDnyhYPKFyMK6ufqessxZZBmIAGkD+17shL kHgRPepyognblzZW634CpL2vG6p5PwI8DaiM3CrGEYCNyVFoCDMoiUSqIvISSO/L v/ZpNw0NginN4NT6ZXFS+HTERrgrz4q0HtoI8FDYJjcao6LevtKKGfbCMjtbutJe zwacjoECgYEA2F/v6ZZx1OveCw6J9HNxwxwQVNUtTZlsyxrRQk8PHYWkVgPkVIMx BmqVHh98F+4MHZnERi1Yd2bN8FtS3XJv0g6cKnXpCwoscGyNLD+IHjXWK9/WI+74 yyt5kjWQWrlL0cuIrd+ekPAct1lW4aboZSSkeSXotJvNJC8avQ5SwkcCgYEAxJgj GJB6eV/G+bQEjAi2sxphRe8Oz3TC6O30eJa3MBWyspnlK1KxMbfqBqCA6yqdvghj QZghONwHFgRwtV72EO4augj+qsSFWWanhGAnBzydv0fk53DYhB3k8j+BqY/8g+VR ghB7MwwPffsCG3RH6GidFX/53OljI2tqILTvaBECgYEA1Kx3g4D8Iew0M2n27u8J wlyzMK7X+I31AS06wZIzqTDSdjkdFHRem4/nQdRwhJTWE8IvyUqIydOiV71rlX4F qtHxbUq35MH7LAWGPRe1EvyXpkg8ktUwdYIl3DAJ0yKOA4eqsDw7/voDP7PwUZtc kQ2THADG2b7Jw+cIwQpzDcECgYAZYLpHFX95448/9KkRmp5bCHC+Iln7FcuDXhRM 7MfBAUwMGimnKgmNrXwcVuPNd7bdLSAC+6xuNpkDkpcqEpQZI2N32Glnie7c14+Q WwkuufhzFMjLx5lrlKBVVTVbuiaSsCuRaqc8s7XcQWbIPH571eVRPS/4AHi3vcn5 ZuHwwQKBgQCg+6g8oZJMIYIDxpKnFD6LVicL1aqqbPKBVkGQctwm2rx00C7feeXh PvGDon8H4FdLTFRfMfSFV7Prnk2vzFFFRz5U3JVxsK77FkigEiV7WAaxM7gW5+2N zo9O7481Eqd1OxofiLfSJHckDNORZgNvBLBZRoPERNuLVxtacIYxFA== -----END RSA PRIVATE KEY-----</p><h3 id="参考链接" tabindex="-1">参考链接 <a class="header-anchor" href="#参考链接" aria-hidden="true">#</a></h3><p><strong>Github DEMO示例：</strong><br><a href="https://github.com/lanbingcloud/demo-vcluster-tekton-argoevents-vaultagent-externalsecrets" target="_blank" rel="noreferrer">https://github.com/lanbingcloud/demo-vcluster-tekton-argoevents-vaultagent-externalsecrets</a><br><a href="https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton" target="_blank" rel="noreferrer">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton</a></p><p><strong>B站讲解视频：</strong><br><a href="https://www.bilibili.com/video/BV1yP4y1U7mS/" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV1yP4y1U7mS/</a><br><a href="https://www.bilibili.com/video/BV1Fm4y1A7qL/" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV1Fm4y1A7qL/</a></p><p><strong>vault相关：</strong><br><a href="https://developer.hashicorp.com/vault/docs/install#installing-vault" target="_blank" rel="noreferrer">https://developer.hashicorp.com/vault/docs/install#installing-vault</a><br><a href="https://developer.hashicorp.com/vault/docs/install#precompiled-binaries" target="_blank" rel="noreferrer">https://developer.hashicorp.com/vault/docs/install#precompiled-binaries</a><br><a href="https://support.hashicorp.com/hc/en-us/articles/4404389946387-Kubernetes-auth-method-Permission-Denied-error" target="_blank" rel="noreferrer">https://support.hashicorp.com/hc/en-us/articles/4404389946387-Kubernetes-auth-method-Permission-Denied-error</a><br><a href="https://developer.hashicorp.com/vault/docs" target="_blank" rel="noreferrer">https://developer.hashicorp.com/vault/docs</a></p><p><strong>argoCD命令行安装：</strong><br><a href="https://tanzu.vmware.com/developer/guides/argocd-gs/#install-and-set-up-the-argocd-cli" target="_blank" rel="noreferrer">https://tanzu.vmware.com/developer/guides/argocd-gs/#install-and-set-up-the-argocd-cli</a></p><p><strong>github access token：</strong><br><a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank" rel="noreferrer">https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token</a></p><p><strong>github ssh证书相关：</strong><br><a href="https://docs.github.com/cn/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" target="_blank" rel="noreferrer">https://docs.github.com/cn/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent</a><br><a href="https://docs.github.com/cn/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account" target="_blank" rel="noreferrer">https://docs.github.com/cn/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account</a></p><p><strong>argoevent webhook：</strong><br><a href="https://argoproj.github.io/argo-events/eventsources/webhook-authentication/" target="_blank" rel="noreferrer">https://argoproj.github.io/argo-events/eventsources/webhook-authentication/</a></p><p><strong>推送image到github仓库：</strong><br><a href="https://docs.github.com/en/actions/publishing-packages/publishing-docker-images" target="_blank" rel="noreferrer">https://docs.github.com/en/actions/publishing-packages/publishing-docker-images</a></p><h3 id="替换服务地址配置" tabindex="-1"><strong>替换服务地址配置</strong> <a class="header-anchor" href="#替换服务地址配置" aria-hidden="true">#</a></h3><h4 id="代码库：demo-pipeline-argoevents-tekton" tabindex="-1">代码库：demo-pipeline-argoevents-tekton <a class="header-anchor" href="#代码库：demo-pipeline-argoevents-tekton" aria-hidden="true">#</a></h4><p>fork demo-pipeline-argoevents-tekton代码库，修改复制后的代码库。</p><h5 id="替换监听的代码库地址" tabindex="-1">替换监听的代码库地址 <a class="header-anchor" href="#替换监听的代码库地址" aria-hidden="true">#</a></h5><p>相对路径：app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">production</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/runtime-appset.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">runtimes/{{runtime}}</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/cert-manager-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cert-manager/overlays/production</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/runtime-argocd-appset.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">argocd/overlays/production</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/vcluster-appset.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vclusters/{{cluster}}</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/patch-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">production/patch</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：vclusters/vcluster1/vcluster1-patch-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vclusters/vcluster1/vcluster1-patch</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：runtimes/pipeline1-runtime/pipeline1-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-pipeline</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">runtimes/pipeline1-runtime/production</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：runtimes/pipeline1-runtime/production/argo-events-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-pipeline</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">argo-events/overlays/production</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：runtimes/pipeline1-runtime/production/user-namespaces-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-pipeline</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">user-namespaces</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：runtimes/pipeline1-runtime/production/tekton-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-pipeline</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tekton/overlays/production</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：runtimes/pipeline1-runtime/production/patch-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-pipeline</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">runtimes/pipeline1-runtime/production/patch</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;"># 替换为fork下来的代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><h5 id="替换宿主集群ip地址、宿主机ip、vault服务端ip" tabindex="-1">替换宿主集群IP地址、宿主机IP、vault服务端IP <a class="header-anchor" href="#替换宿主集群ip地址、宿主机ip、vault服务端ip" aria-hidden="true">#</a></h5><p>相对路径：vclusters/vcluster1/vcluster1-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">helm</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#C792EA;">-</span></span>\n<span class="line"><span style="color:#C3E88D;">        vcluster:</span></span>\n<span class="line"><span style="color:#C3E88D;">          image: rancher/k3s:v1.21.13-k3s1</span></span>\n<span class="line"><span style="color:#C3E88D;">        syncer:</span></span>\n<span class="line"><span style="color:#C3E88D;">          extraArgs:</span></span>\n<span class="line highlighted"><span style="color:#C3E88D;">          - --tls-san=192.168.0.243   # 替换为宿主机的内网IP</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：argo-events/overlays/production/secretstore.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">provider</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">vault</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;"># 替换为vault服务端的IP和端口，由于本示例的vault服务部署在宿主机上因此使用内网IP</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">server</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://192.168.0.243:31820</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">v2</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：cert-manager/overlays/production/secretstore.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">provider</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">vault</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;"># 替换为vault服务端的IP和端口，由于本示例的vault服务部署在宿主机上因此使用内网IP</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">server</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://192.168.0.243:31820</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pki</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">v2</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/metallb-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">helm</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#C792EA;">-</span></span>\n<span class="line"><span style="color:#C3E88D;">        configInline:</span></span>\n<span class="line"><span style="color:#C3E88D;">          address-pools:</span></span>\n<span class="line"><span style="color:#C3E88D;">          - name: default</span></span>\n<span class="line"><span style="color:#C3E88D;">            protocol: layer2</span></span>\n<span class="line"><span style="color:#C3E88D;">            addresses:</span></span>\n<span class="line highlighted"><span style="color:#C3E88D;">            - 192.168.0.243-192.168.0.243    # 替换为宿主机的内网IP</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/runtime-appset.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">generators</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">list</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">elements</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">runtime</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pipeline1-runtime</span></span>\n<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 替换为宿主集群的IP地址和端口，此处为内网IP</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">clusterURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://192.168.0.243:31543</span><span style="color:#A6ACCD;">    </span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">runtimes/{{runtime}}</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">destination</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">server</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{{clusterURL}}</span><span style="color:#89DDFF;">&#39;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">argocd</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/vault-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">helm</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#C792EA;">-</span></span>\n<span class="line"><span style="color:#C3E88D;">        global:</span></span>\n<span class="line"><span style="color:#C3E88D;">          enabled: false</span></span>\n<span class="line"><span style="color:#C3E88D;">        injector:</span></span>\n<span class="line"><span style="color:#C3E88D;">          enabled: true</span></span>\n<span class="line"><span style="color:#C3E88D;">          authPath: auth/host-cluster</span></span>\n<span class="line highlighted"><span style="color:#C3E88D;">          externalVaultAddr: http://192.168.0.243:31820  #替换为vault服务的IP和端口</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/runtime-argocd-appset.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">generators</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">list</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">elements</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">runtime</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pipeline1-runtime-argocd</span></span>\n<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 替换为宿主集群的IP地址和端口，此处为内网IP</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">clusterURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://192.168.0.243:31543</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-vcluster</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">repoURL</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-pipeline-argoevents-tekton-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">targetRevision</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAD</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">argocd/overlays/production</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">destination</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">server</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{{clusterURL}}</span><span style="color:#89DDFF;">&#39;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">argocd</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：runtimes/pipeline1-runtime/production/vault-app.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">project</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-pipeline</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">helm</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">values</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#C792EA;">-</span></span>\n<span class="line"><span style="color:#C3E88D;">        global:</span></span>\n<span class="line"><span style="color:#C3E88D;">          enabled: false</span></span>\n<span class="line"><span style="color:#C3E88D;">        injector:</span></span>\n<span class="line"><span style="color:#C3E88D;">          enabled: true</span></span>\n<span class="line"><span style="color:#C3E88D;">          authPath: auth/pipeline1-cluster</span></span>\n<span class="line highlighted"><span style="color:#C3E88D;">          externalVaultAddr: http://192.168.0.243:31820  #替换为vault服务的IP和端口</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><h5 id="替换ingress地址" tabindex="-1">替换ingress地址 <a class="header-anchor" href="#替换ingress地址" aria-hidden="true">#</a></h5><p>相对路径：argo-events/overlays/production/eventsource.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">github</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">user-project</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">webhook</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">endpoint</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/user-project</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">12000</span><span style="color:#89DDFF;">&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">POST</span></span>\n<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 替换为宿主机IP，本示例的宿主机外网IP地址为119.8.99.179</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://webhook.pipeline1.119-8-99-179.nip.io:30080</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：argo-events/overlays/production/ingress-webhook-eventsource.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">networking.k8s.io/v1</span></span>\n<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Ingress</span></span>\n<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">webhook-eventsource</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">argo-events</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">   </span><span style="color:#676E95;"># 替换为宿主机IP</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">webhook.pipeline1.119-8-99-179.nip.io</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：production/patch/ingress-argocd.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># 替换为宿主机IP</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">argocd.119-8-99-179.nip.io</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">http</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">paths</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">pathType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ImplementationSpecific</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：runtimes/pipeline1-runtime/production/patch/ingress-argocd.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># 替换为宿主机IP</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">argocd.pipeline1.119-8-99-179.nip.io</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">http</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">paths</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">pathType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ImplementationSpecific</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><p>相对路径：tekton/overlays/production/dashboard-ingress.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># 替换为宿主机IP</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tekton.pipeline1.119-8-99-179.nip.io</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">http</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">paths</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">pathType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ImplementationSpecific</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><h5 id="替换argo-events-eventsource的repo信息" tabindex="-1">替换argo-events eventsource的repo信息 <a class="header-anchor" href="#替换argo-events-eventsource的repo信息" aria-hidden="true">#</a></h5><p>相对路径：argo-events/overlays/production/eventsource.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">github</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">user-project</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">repositories</span><span style="color:#89DDFF;">:</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">owner</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">lanbingcloud</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;"># 替换为eventsource监听的代码库的owner</span></span>\n<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">names</span><span style="color:#89DDFF;">:</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">demo-user-project-1</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;"># 替换为eventsource监听的代码库</span></span>\n<span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"></span></code></pre></div><h5 id="替换init-pipeline-git-clone任务的代码库地址" tabindex="-1">替换init-pipeline git clone任务的代码库地址 <a class="header-anchor" href="#替换init-pipeline-git-clone任务的代码库地址" aria-hidden="true">#</a></h5><p>相对路径：argo-events/overlays/production/init-pipeline.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">triggers</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init-pipeine</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">k8s</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">operation</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span></span>\n<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">resource</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#F07178;">pipelineSpec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#F07178;">params</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#F07178;">tasks</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git-clone</span></span>\n<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#F07178;">taskRef</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git-clone</span></span>\n<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterTask</span></span>\n<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#F07178;">workspaces</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">output</span></span>\n<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#F07178;">workspace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">source-volume</span></span>\n<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#F07178;">subPath</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">$(params.REVISION)</span></span>\n<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#F07178;">params</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">url</span></span>\n<span class="line"><span style="color:#89DDFF;">                      </span><span style="color:#676E95;"># 替换为fork下来的用户侧代码库地址</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">                      </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-user-project-1.git</span></span>\n<span class="line"></span></code></pre></div><h4 id="代码库：demo-user-project" tabindex="-1">代码库：demo-user-project <a class="header-anchor" href="#代码库：demo-user-project" aria-hidden="true">#</a></h4><p>fork demo-user-project代码库，修改复制后的代码库。 替换流水线task拉取代码、推送代码、推送镜像的地址。</p><p>相对路径：pipelines/test-pipeline.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#FFCB6B;">...</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">pipelineSpec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">tasks</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git-clone-sourcecode</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">params</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">url</span></span>\n<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 替换为fork下来的用户侧代码库</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/lanbingcloud/demo-user-project-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git-clone-deployment</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">params</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">url</span></span>\n<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 替换为fork下来的部署运行时的代码库</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git@github.com:lanbingcloud/demo-user-deployments-1.git</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">image-build</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">runAfter</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mvn-build</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">taskRef</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kaniko</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterTask</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">workspaces</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">source</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">workspace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">source-volume</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">params</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">IMAGE</span></span>\n<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;"># 替换为github镜像仓库地址，根据实际情况更新</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ghcr.io/zhangsan/devops-sample:0.0.1-$(tasks.git-clone-sourcecode.results.commit)</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">DOCKERFILE</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./sourcecode/Dockerfile</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CONTEXT</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./sourcecode</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">manifest-update</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">runAfter</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">image-build</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">taskRef</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git-cli</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ClusterTask</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">workspaces</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">source</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">workspace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">source-volume</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">params</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">...</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">GIT_SCRIPT</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span></span>\n<span class="line"><span style="color:#C3E88D;">          cd deployment</span></span>\n<span class="line"><span style="color:#89DDFF;">         </span><span style="color:#676E95;"># 使用sed字符串替换镜像地址，根据实际情况更新</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">          </span><span style="color:#C3E88D;">sed -i -e &quot;s#ghcr.io/zhangsan/devops-sample.*#$(tasks.image-build.results.IMAGE_URL)#g&quot; deployments/test/devops-sample.yaml</span></span>\n<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#C3E88D;">git add deployments/test/devops-sample.yaml</span></span>\n<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">git commit -a -m &quot;automatic update by pipeline bot</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">$(tasks.image-build.results.IMAGE_URL)&quot;</span></span>\n<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#C3E88D;">git push origin HEAD:$(params.REVISION) --force</span></span>\n<span class="line"></span></code></pre></div><h4 id="代码库：demo-user-deployments" tabindex="-1">代码库：demo-user-deployments <a class="header-anchor" href="#代码库：demo-user-deployments" aria-hidden="true">#</a></h4><p>fork demo-user-deployments代码库，修改复制后的代码库。替换业务应用svc的外部访问地址。</p><p>相对路径：deployments/test/devops-sample-svc.yaml</p><div class="language-yaml"><button class="copy"></button><span class="lang">yaml</span><pre><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">networking.k8s.io/v1</span></span>\n<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Ingress</span></span>\n<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ks-sample-dev</span></span>\n<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># 替换为宿主机外网IP</span></span>\n<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">devops-sample.119-8-99-179.nip.io</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">http</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">paths</span><span style="color:#89DDFF;">:</span></span>\n<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span></span>\n<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">pathType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ImplementationSpecific</span></span>\n<span class="line"></span></code></pre></div><h2 id="未完成（2022-11-12，正式提交后删除该章节）" tabindex="-1">未完成（2022.11.12，正式提交后删除该章节） <a class="header-anchor" href="#未完成（2022-11-12，正式提交后删除该章节）" aria-hidden="true">#</a></h2><p>一 内容</p><ol><li>网络相关：traefik、ingress、metallab</li><li>证书相关：cert-manager</li><li>github： 1）https协议，客户端的认证的异常（OPENSSL 443） 2）github secrets 3）access token：fine-grained token；</li></ol>',145)];const t=s(e,[["render",function(s,l,p,e,t,c){return a(),n("div",null,o)}]]);export{p as __pageData,t as default};
